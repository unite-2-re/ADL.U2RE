function t(t){return 0>t?-1:0===t?0:1}function s(t,s,h){return(1-h)*t+h*s}function h(t,s){return[t[0]*s[0][0]+t[1]*s[0][1]+t[2]*s[0][2],t[0]*s[1][0]+t[1]*s[1][1]+t[2]*s[1][2],t[0]*s[2][0]+t[1]*s[2][1]+t[2]*s[2][2]]}function i(t,s,h){return(255<<24|(255&t)<<16|(255&s)<<8|255&h)>>>0}function n(t){return i(l(t[0]),l(t[1]),l(t[2]))}function r(t){return t>>16&255}function e(t){return t>>8&255}function a(t){return 255&t}function o(t,s,h){const n=g[1][0]*t+g[1][1]*s+g[1][2]*h,r=g[2][0]*t+g[2][1]*s+g[2][2]*h;return i(l(g[0][0]*t+g[0][1]*s+g[0][2]*h),l(n),l(r))}function c(t){const s=(t=>h([u(r(t)),u(e(t)),u(a(t))],m))(t)[1];return 116*f(s/100)-16}function M(t){return 100*d((t+16)/116)}function u(t){const s=t/255;return s>.040449936?100*Math.pow((s+.055)/1.055,2.4):s/12.92*100}function l(t){const s=t/100;let h=0;return h=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:12.92*s,0>(i=Math.round(255*h))?0:i>255?255:i;var i}function f(t){return t>216/24389?Math.pow(t,1/3):(24389/27*t+16)/116}function d(t){const s=t*t*t;return s>216/24389?s:(116*t-16)/(24389/27)}function w(t){const s=r(t),h=e(t),i=a(t),n=[s.toString(16),h.toString(16),i.toString(16)];for(const[t,s]of n.entries())1===s.length&&(n[t]="0"+s);return"#"+n.join("")}const m=[[.41233895,.35762064,.18051042],[.2126,.7152,.0722],[.01932141,.11916382,.95034478]],g=[[3.2413774792388685,-1.5376652402851851,-.49885366846268053],[-.9691452513005321,1.8758853451067872,.04156585616912061],[.05562093689691305,-.20395524564742123,1.0571799111220335]],y=[95.047,100,108.883];class A{static make(t=(()=>y)(),h=200/Math.PI*M(50)/100,i=50,n=2,r=0){const e=.401288*t[0]+.650173*t[1]+-.051461*t[2],a=-.250268*t[0]+1.204414*t[1]+.045854*t[2],o=-.002079*t[0]+.048952*t[1]+.953127*t[2],c=.8+n/10,u=.9>c?s(.525,.59,10*(c-.8)):s(.59,.69,10*(c-.9));let l=r?1:c*(1-1/3.6*Math.exp((-h-42)/92));l=l>1?1:0>l?0:l;const f=c,d=[l*(100/e)+1-l,l*(100/a)+1-l,l*(100/o)+1-l],w=1/(5*h+1),m=w*w*w*w,g=1-m,I=m*h+.1*g*g*Math.cbrt(5*h),p=M(i)/t[1],v=1.48+Math.sqrt(p),b=.725/Math.pow(p,.2),C=b,x=[Math.pow(I*d[0]*e/100,.42),Math.pow(I*d[1]*a/100,.42),Math.pow(I*d[2]*o/100,.42)],z=[400*x[0]/(x[0]+27.13),400*x[1]/(x[1]+27.13),400*x[2]/(x[2]+27.13)];return new A(p,(2*z[0]+z[1]+.05*z[2])*b,b,C,u,f,d,I,Math.pow(I,.25),v)}constructor(t,s,h,i,n,r,e,a,o,c){this.n=t,this.aw=s,this.nbb=h,this.ncb=i,this.c=n,this.nc=r,this.rgbD=e,this.fl=a,this.fLRoot=o,this.z=c}}A.DEFAULT=A.make();class I{constructor(t,s,h,i,n,r,e,a,o){this.hue=t,this.chroma=s,this.j=h,this.q=i,this.m=n,this.s=r,this.jstar=e,this.astar=a,this.bstar=o}distance(t){const s=this.jstar-t.jstar,h=this.astar-t.astar,i=this.bstar-t.bstar;return 1.41*Math.pow(Math.sqrt(s*s+h*h+i*i),.63)}static fromInt(t){return I.fromIntInViewingConditions(t,A.DEFAULT)}static fromIntInViewingConditions(s,h){const i=(65280&s)>>8,n=255&s,r=u((16711680&s)>>16),e=u(i),a=u(n),o=.41233895*r+.35762064*e+.18051042*a,c=.2126*r+.7152*e+.0722*a,M=.01932141*r+.11916382*e+.95034478*a,l=h.rgbD[0]*(.401288*o+.650173*c-.051461*M),f=h.rgbD[1]*(-.250268*o+1.204414*c+.045854*M),d=h.rgbD[2]*(-.002079*o+.048952*c+.953127*M),w=Math.pow(h.fl*Math.abs(l)/100,.42),m=Math.pow(h.fl*Math.abs(f)/100,.42),g=Math.pow(h.fl*Math.abs(d)/100,.42),y=400*t(l)*w/(w+27.13),A=400*t(f)*m/(m+27.13),p=400*t(d)*g/(g+27.13),v=(11*y+-12*A+p)/11,b=(y+A-2*p)/9,C=(20*y+20*A+21*p)/20,x=(40*y+20*A+p)/20,z=180*Math.atan2(b,v)/Math.PI,V=0>z?z+360:360>z?z:z-360,k=V*Math.PI/180,q=100*Math.pow(x*h.nbb/h.aw,h.c*h.z),B=4/h.c*Math.sqrt(q/100)*(h.aw+4)*h.fLRoot,T=Math.pow(5e4/13*.25*(Math.cos((20.14>V?V+360:V)*Math.PI/180+2)+3.8)*h.nc*h.ncb*Math.sqrt(v*v+b*b)/(C+.305),.9)*Math.pow(1.64-Math.pow(.29,h.n),.73),E=T*Math.sqrt(q/100),J=E*h.fLRoot,P=50*Math.sqrt(T*h.c/(h.aw+4)),R=(1+100*.007)*q/(1+.007*q),H=1/.0228*Math.log(1+.0228*J);return new I(V,E,q,B,J,P,R,H*Math.cos(k),H*Math.sin(k))}static fromJch(t,s,h){return I.fromJchInViewingConditions(t,s,h,A.DEFAULT)}static fromJchInViewingConditions(t,s,h,i){const n=4/i.c*Math.sqrt(t/100)*(i.aw+4)*i.fLRoot,r=s*i.fLRoot,e=50*Math.sqrt(s/Math.sqrt(t/100)*i.c/(i.aw+4)),a=h*Math.PI/180,o=(1+100*.007)*t/(1+.007*t),c=1/.0228*Math.log(1+.0228*r);return new I(h,s,t,n,r,e,o,c*Math.cos(a),c*Math.sin(a))}static fromUcs(t,s,h){return I.fromUcsInViewingConditions(t,s,h,A.DEFAULT)}static fromUcsInViewingConditions(t,s,h,i){const n=s,r=h,e=(Math.exp(.0228*Math.sqrt(n*n+r*r))-1)/.0228/i.fLRoot;let a=Math.atan2(r,n)*(180/Math.PI);return 0>a&&(a+=360),I.fromJchInViewingConditions(t/(1-.007*(t-100)),e,a,i)}toInt(){return this.viewed(A.DEFAULT)}viewed(s){const h=Math.pow((0===this.chroma||0===this.j?0:this.chroma/Math.sqrt(this.j/100))/Math.pow(1.64-Math.pow(.29,s.n),.73),1/.9),i=this.hue*Math.PI/180,n=.25*(Math.cos(i+2)+3.8)*(5e4/13)*s.nc*s.ncb,r=s.aw*Math.pow(this.j/100,1/s.c/s.z)/s.nbb,e=Math.sin(i),a=Math.cos(i),c=23*(r+.305)*h/(23*n+11*h*a+108*h*e),M=c*a,u=c*e,l=(460*r+451*M+288*u)/1403,f=(460*r-891*M-261*u)/1403,d=(460*r-220*M-6300*u)/1403,w=Math.max(0,27.13*Math.abs(l)/(400-Math.abs(l))),m=t(l)*(100/s.fl)*Math.pow(w,1/.42),g=Math.max(0,27.13*Math.abs(f)/(400-Math.abs(f))),y=t(f)*(100/s.fl)*Math.pow(g,1/.42),A=Math.max(0,27.13*Math.abs(d)/(400-Math.abs(d))),I=t(d)*(100/s.fl)*Math.pow(A,1/.42),p=m/s.rgbD[0],v=y/s.rgbD[1],b=I/s.rgbD[2];return o(1.86206786*p-1.01125463*v+.14918677*b,.38752654*p+.62144744*v-.00897398*b,-.0158415*p-.03412294*v+1.04996444*b)}static fromXyzInViewingConditions(s,h,i,n){const r=n.rgbD[0]*(.401288*s+.650173*h-.051461*i),e=n.rgbD[1]*(-.250268*s+1.204414*h+.045854*i),a=n.rgbD[2]*(-.002079*s+.048952*h+.953127*i),o=Math.pow(n.fl*Math.abs(r)/100,.42),c=Math.pow(n.fl*Math.abs(e)/100,.42),M=Math.pow(n.fl*Math.abs(a)/100,.42),u=400*t(r)*o/(o+27.13),l=400*t(e)*c/(c+27.13),f=400*t(a)*M/(M+27.13),d=(11*u+-12*l+f)/11,w=(u+l-2*f)/9,m=(20*u+20*l+21*f)/20,g=(40*u+20*l+f)/20,y=180*Math.atan2(w,d)/Math.PI,A=0>y?y+360:360>y?y:y-360,p=A*Math.PI/180,v=100*Math.pow(g*n.nbb/n.aw,n.c*n.z),b=4/n.c*Math.sqrt(v/100)*(n.aw+4)*n.fLRoot,C=Math.pow(5e4/13*(1/4)*(Math.cos((20.14>A?A+360:A)*Math.PI/180+2)+3.8)*n.nc*n.ncb*Math.sqrt(d*d+w*w)/(m+.305),.9)*Math.pow(1.64-Math.pow(.29,n.n),.73),x=C*Math.sqrt(v/100),z=x*n.fLRoot,V=50*Math.sqrt(C*n.c/(n.aw+4)),k=(1+100*.007)*v/(1+.007*v),q=Math.log(1+.0228*z)/.0228;return new I(A,x,v,b,z,V,k,q*Math.cos(p),q*Math.sin(p))}xyzInViewingConditions(s){const h=Math.pow((0===this.chroma||0===this.j?0:this.chroma/Math.sqrt(this.j/100))/Math.pow(1.64-Math.pow(.29,s.n),.73),1/.9),i=this.hue*Math.PI/180,n=.25*(Math.cos(i+2)+3.8)*(5e4/13)*s.nc*s.ncb,r=s.aw*Math.pow(this.j/100,1/s.c/s.z)/s.nbb,e=Math.sin(i),a=Math.cos(i),o=23*(r+.305)*h/(23*n+11*h*a+108*h*e),c=o*a,M=o*e,u=(460*r+451*c+288*M)/1403,l=(460*r-891*c-261*M)/1403,f=(460*r-220*c-6300*M)/1403,d=Math.max(0,27.13*Math.abs(u)/(400-Math.abs(u))),w=t(u)*(100/s.fl)*Math.pow(d,1/.42),m=Math.max(0,27.13*Math.abs(l)/(400-Math.abs(l))),g=t(l)*(100/s.fl)*Math.pow(m,1/.42),y=Math.max(0,27.13*Math.abs(f)/(400-Math.abs(f))),A=t(f)*(100/s.fl)*Math.pow(y,1/.42),I=w/s.rgbD[0],p=g/s.rgbD[1],v=A/s.rgbD[2];return[1.86206786*I-1.01125463*p+.14918677*v,.38752654*I+.62144744*p-.00897398*v,-.0158415*I-.03412294*p+1.04996444*v]}}class p{static sanitizeRadians(t){return(t+8*Math.PI)%(2*Math.PI)}static trueDelinearized(t){const s=t/100;let h=0;return h=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:12.92*s,255*h}static chromaticAdaptation(s){const h=Math.pow(Math.abs(s),.42);return 400*t(s)*h/(h+27.13)}static hueOf(t){const s=h(t,p.SCALED_DISCOUNT_FROM_LINRGB),i=p.chromaticAdaptation(s[0]),n=p.chromaticAdaptation(s[1]),r=p.chromaticAdaptation(s[2]);return Math.atan2((i+n-2*r)/9,(11*i+-12*n+r)/11)}static areInCyclicOrder(t,s,h){const i=p.sanitizeRadians(s-t);return p.sanitizeRadians(h-t)>i}static intercept(t,s,h){return(s-t)/(h-t)}static lerpPoint(t,s,h){return[t[0]+(h[0]-t[0])*s,t[1]+(h[1]-t[1])*s,t[2]+(h[2]-t[2])*s]}static setCoordinate(t,s,h,i){const n=p.intercept(t[i],s,h[i]);return p.lerpPoint(t,n,h)}static isBounded(t){return t>=0&&100>=t}static nthVertex(t,s){const h=p.Y_FROM_LINRGB[0],i=p.Y_FROM_LINRGB[1],n=p.Y_FROM_LINRGB[2],r=s%4>1?100:0,e=s%2==0?0:100;if(4>s){const s=r,a=e,o=(t-s*i-a*n)/h;return p.isBounded(o)?[o,s,a]:[-1,-1,-1]}if(8>s){const s=r,a=e,o=(t-a*h-s*n)/i;return p.isBounded(o)?[a,o,s]:[-1,-1,-1]}{const s=r,a=e,o=(t-s*h-a*i)/n;return p.isBounded(o)?[s,a,o]:[-1,-1,-1]}}static bisectToSegment(t,s){let h=[-1,-1,-1],i=h,n=0,r=0,e=0,a=1;for(let o=0;12>o;o++){const c=p.nthVertex(t,o);if(0>c[0])continue;const M=p.hueOf(c);e?(a||p.areInCyclicOrder(n,M,r))&&(a=0,p.areInCyclicOrder(n,s,M)?(i=c,r=M):(h=c,n=M)):(h=c,i=c,n=M,r=M,e=1)}return[h,i]}static midpoint(t,s){return[(t[0]+s[0])/2,(t[1]+s[1])/2,(t[2]+s[2])/2]}static criticalPlaneBelow(t){return Math.floor(t-.5)}static criticalPlaneAbove(t){return Math.ceil(t-.5)}static bisectToLimit(t,s){const h=p.bisectToSegment(t,s);let i=h[0],n=p.hueOf(i),r=h[1];for(let t=0;3>t;t++)if(i[t]!==r[t]){let h=-1,e=255;r[t]>i[t]?(h=p.criticalPlaneBelow(p.trueDelinearized(i[t])),e=p.criticalPlaneAbove(p.trueDelinearized(r[t]))):(h=p.criticalPlaneAbove(p.trueDelinearized(i[t])),e=p.criticalPlaneBelow(p.trueDelinearized(r[t])));for(let a=0;8>a&&Math.abs(e-h)>1;a++){const a=Math.floor((h+e)/2),o=p.setCoordinate(i,p.CRITICAL_PLANES[a],r,t),c=p.hueOf(o);p.areInCyclicOrder(n,s,c)?(r=o,e=a):(i=o,n=c,h=a)}}return p.midpoint(i,r)}static inverseChromaticAdaptation(s){const h=Math.abs(s),i=Math.max(0,27.13*h/(400-h));return t(s)*Math.pow(i,1/.42)}static findResultByJ(t,s,i){let r=11*Math.sqrt(i);const e=A.DEFAULT,a=1/Math.pow(1.64-Math.pow(.29,e.n),.73),o=.25*(Math.cos(t+2)+3.8)*(5e4/13)*e.nc*e.ncb,c=Math.sin(t),M=Math.cos(t);for(let t=0;5>t;t++){const u=r/100,l=Math.pow((0===s||0===r?0:s/Math.sqrt(u))*a,1/.9),f=e.aw*Math.pow(u,1/e.c/e.z)/e.nbb,d=23*(f+.305)*l/(23*o+11*l*M+108*l*c),w=d*M,m=d*c,g=(460*f-891*w-261*m)/1403,y=(460*f-220*w-6300*m)/1403,A=h([p.inverseChromaticAdaptation((460*f+451*w+288*m)/1403),p.inverseChromaticAdaptation(g),p.inverseChromaticAdaptation(y)],p.LINRGB_FROM_SCALED_DISCOUNT);if(0>A[0]||0>A[1]||0>A[2])return 0;const I=p.Y_FROM_LINRGB[0]*A[0]+p.Y_FROM_LINRGB[1]*A[1]+p.Y_FROM_LINRGB[2]*A[2];if(0>=I)return 0;if(4===t||.002>Math.abs(I-i))return A[0]>100.01||A[1]>100.01||A[2]>100.01?0:n(A);r-=(I-i)*r/(2*I)}return 0}static solveToInt(t,s,h){if(1e-4>s||1e-4>h||h>99.9999)return(t=>{const s=l(M(t));return i(s,s,s)})(h);var r;r=t,0>(r%=360)&&(r+=360);const e=(t=r)/180*Math.PI,a=M(h),o=p.findResultByJ(e,s,a);return 0!==o?o:n(p.bisectToLimit(a,e))}static solveToCam(t,s,h){return I.fromInt(p.solveToInt(t,s,h))}}p.SCALED_DISCOUNT_FROM_LINRGB=[[.001200833568784504,.002389694492170889,.0002795742885861124],[.0005891086651375999,.0029785502573438758,.0003270666104008398],[.00010146692491640572,.0005364214359186694,.0032979401770712076]],p.LINRGB_FROM_SCALED_DISCOUNT=[[1373.2198709594231,-1100.4251190754821,-7.278681089101213],[-271.815969077903,559.6580465940733,-32.46047482791194],[1.9622899599665666,-57.173814538844006,308.7233197812385]],p.Y_FROM_LINRGB=[.2126,.7152,.0722],p.CRITICAL_PLANES=[.015176349177441876,.045529047532325624,.07588174588720938,.10623444424209313,.13658714259697685,.16693984095186062,.19729253930674434,.2276452376616281,.2579979360165119,.28835063437139563,.3188300904430532,.350925934958123,.3848314933096426,.42057480301049466,.458183274052838,.4976837250274023,.5391024159806381,.5824650784040898,.6277969426914107,.6751227633498623,.7244668422128921,.775853049866786,.829304845476233,.8848452951698498,.942497089126609,1.0022825574869039,1.0642236851973577,1.1283421258858297,1.1946592148522128,1.2631959812511864,1.3339731595349034,1.407011200216447,1.4823302800086415,1.5599503113873272,1.6398909516233677,1.7221716113234105,1.8068114625156377,1.8938294463134073,1.9832442801866852,2.075074464868551,2.1693382909216234,2.2660538449872063,2.36523901573795,2.4669114995532007,2.5710888059345764,2.6777882626779785,2.7870270208169257,2.898822059350997,3.0131901897720907,3.1301480604002863,3.2497121605402226,3.3718988244681087,3.4967242352587946,3.624204428461639,3.754355295633311,3.887192587735158,4.022731918402185,4.160988767090289,4.301978482107941,4.445716283538092,4.592217266055746,4.741496401646282,4.893568542229298,5.048448422192488,5.20615066083972,5.3666897647573375,5.5300801301023865,5.696336044816294,5.865471690767354,6.037501145825082,6.212438385869475,6.390297286737924,6.571091626112461,6.7548350853498045,6.941541251256611,7.131223617812143,7.323895587840543,7.5195704746346665,7.7182615035334345,7.919981813454504,8.124744458384042,8.332562408825165,8.543448553206703,8.757415699253682,8.974476575321063,9.194643831691977,9.417930041841839,9.644347703669503,9.873909240696694,10.106627003236781,10.342513269534024,10.58158024687427,10.8238400726681,11.069304815507364,11.317986476196008,11.569896988756009,11.825048221409341,12.083451977536606,12.345119996613247,12.610063955123938,12.878295467455942,13.149826086772048,13.42466730586372,13.702830557985108,13.984327217668513,14.269168601521828,14.55736596900856,14.848930523210871,15.143873411576273,15.44220572664832,15.743938506781891,16.04908273684337,16.35764934889634,16.66964922287304,16.985093187232053,17.30399201960269,17.62635644741625,17.95219714852476,18.281524751807332,18.614349837764564,18.95068293910138,19.290534541298456,19.633915083172692,19.98083495742689,20.331304511189067,20.685334046541502,21.042933821039977,21.404114048223256,21.76888489811322,22.137256497705877,22.50923893145328,22.884842241736916,23.264076429332462,23.6469514538663,24.033477234264016,24.42366364919083,24.817520537484558,25.21505769858089,25.61628489293138,26.021211842414342,26.429848230738664,26.842203703840827,27.258287870275353,27.678110301598522,28.10168053274597,28.529008062403893,28.96010235337422,29.39497283293396,29.83362889318845,30.276079891419332,30.722335150426627,31.172403958865512,31.62629557157785,32.08401920991837,32.54558406207592,33.010999283389665,33.4802739966603,33.953417292456834,34.430438229418264,34.911345834551085,35.39614910352207,35.88485700094671,36.37747846067349,36.87402238606382,37.37449765026789,37.87891309649659,38.38727753828926,38.89959975977785,39.41588851594697,39.93615253289054,40.460400508064545,40.98864111053629,41.520882981230194,42.05713473317016,42.597404951718396,43.141702194811224,43.6900349931913,44.24241185063697,44.798841244188324,45.35933162437017,45.92389141541209,46.49252901546552,47.065252796817916,47.64207110610409,48.22299226451468,48.808024568002054,49.3971762874833,49.9904556690408,50.587870934119984,51.189430279724725,51.79514187861014,52.40501387947288,53.0190544071392,53.637271562750364,54.259673423945976,54.88626804504493,55.517063457223934,56.15206766869424,56.79128866487574,57.43473440856916,58.08241284012621,58.734331877617365,59.39049941699807,60.05092333227251,60.715611475655585,61.38457167773311,62.057811747619894,62.7353394731159,63.417162620860914,64.10328893648692,64.79372614476921,65.48848194977529,66.18756403501224,66.89098006357258,67.59873767827808,68.31084450182222,69.02730813691093,69.74813616640164,70.47333615344107,71.20291564160104,71.93688215501312,72.67524319850172,73.41800625771542,74.16517879925733,74.9167682708136,75.67278210128072,76.43322770089146,77.1981124613393,77.96744375590167,78.74122893956174,79.51947534912904,80.30219030335869,81.08938110306934,81.88105503125999,82.67721935322541,83.4778813166706,84.28304815182372,85.09272707154808,85.90692527145302,86.72564993000343,87.54890820862819,88.3767072518277,89.2090541872801,90.04595612594655,90.88742016217518,91.73345337380438,92.58406282226491,93.43925555268066,94.29903859396902,95.16341895893969,96.03240364439274,96.9059996312159,97.78421388448044,98.6670533535366,99.55452497210776];class v{static from(t,s,h){return new v(p.solveToInt(t,s,h))}static fromInt(t){return new v(t)}toInt(){return this.argb}get hue(){return this.internalHue}set hue(t){this.setInternalState(p.solveToInt(t,this.internalChroma,this.internalTone))}get chroma(){return this.internalChroma}set chroma(t){this.setInternalState(p.solveToInt(this.internalHue,t,this.internalTone))}get tone(){return this.internalTone}set tone(t){this.setInternalState(p.solveToInt(this.internalHue,this.internalChroma,t))}constructor(t){this.argb=t;const s=I.fromInt(t);this.internalHue=s.hue,this.internalChroma=s.chroma,this.internalTone=c(t),this.argb=t}setInternalState(t){const s=I.fromInt(t);this.internalHue=s.hue,this.internalChroma=s.chroma,this.internalTone=c(t),this.argb=t}inViewingConditions(t){const s=I.fromInt(this.toInt()).xyzInViewingConditions(t),h=I.fromXyzInViewingConditions(s[0],s[1],s[2],A.make());return v.from(h.hue,h.chroma,116*f(s[1]/100)-16)}}class b{fromInt(t){return(t=>{const s=u(r(t)),h=u(e(t)),i=u(a(t)),n=(m[1][0]*s+m[1][1]*h+m[1][2]*i)/y[1],o=(m[2][0]*s+m[2][1]*h+m[2][2]*i)/y[2],c=f((m[0][0]*s+m[0][1]*h+m[0][2]*i)/y[0]),M=f(n);return[116*M-16,500*(c-M),200*(M-f(o))]})(t)}toInt(t){return((t,s,h)=>{const i=y,n=(t+16)/116,r=n-h/200,e=d(s/500+n),a=d(n),c=d(r);return o(e*i[0],a*i[1],c*i[2])})(t[0],t[1],t[2])}distance(t,s){const h=t[0]-s[0],i=t[1]-s[1],n=t[2]-s[2];return h*h+i*i+n*n}}class C{static quantize(t,s,h){const i=new Map,n=[],r=[],e=new b;let a=0;for(let s=0;t.length>s;s++){const h=t[s],o=i.get(h);void 0===o?(a++,n.push(e.fromInt(h)),r.push(h),i.set(h,1)):i.set(h,o+1)}const o=[];for(let t=0;a>t;t++){const s=i.get(r[t]);void 0!==s&&(o[t]=s)}let c=Math.min(h,a);s.length>0&&(c=Math.min(c,s.length));const M=[];for(let t=0;s.length>t;t++)M.push(e.fromInt(s[t]));const u=c-M.length;if(0===s.length&&u>0)for(let t=0;u>t;t++){const t=100*Math.random(),s=201*Math.random()-100,h=201*Math.random()-100;M.push([t,s,h])}const l=[];for(let t=0;a>t;t++)l.push(Math.floor(Math.random()*c));const f=[];for(let t=0;c>t;t++){f.push([]);for(let s=0;c>s;s++)f[t].push(0)}const d=[];for(let t=0;c>t;t++){d.push([]);for(let s=0;c>s;s++)d[t].push(new x)}const w=[];for(let t=0;c>t;t++)w.push(0);for(let t=0;10>t;t++){for(let t=0;c>t;t++){for(let s=t+1;c>s;s++){const h=e.distance(M[t],M[s]);d[s][t].distance=h,d[s][t].index=t,d[t][s].distance=h,d[t][s].index=s}d[t].sort();for(let s=0;c>s;s++)f[t][s]=d[t][s].index}let s=0;for(let t=0;a>t;t++){const h=n[t],i=l[t],r=e.distance(h,M[i]);let a=r,o=-1;for(let t=0;c>t;t++){if(d[i][t].distance>=4*r)continue;const s=e.distance(h,M[t]);a>s&&(a=s,o=t)}-1!==o&&Math.abs(Math.sqrt(a)-Math.sqrt(r))>3&&(s++,l[t]=o)}if(0===s&&0!==t)break;const h=Array(c).fill(0),i=Array(c).fill(0),r=Array(c).fill(0);for(let t=0;c>t;t++)w[t]=0;for(let t=0;a>t;t++){const s=l[t],e=n[t],a=o[t];w[s]+=a,h[s]+=e[0]*a,i[s]+=e[1]*a,r[s]+=e[2]*a}for(let t=0;c>t;t++){const s=w[t];M[t]=0!==s?[h[t]/s,i[t]/s,r[t]/s]:[0,0,0]}}const m=new Map;for(let t=0;c>t;t++){const s=w[t];if(0===s)continue;const h=e.toInt(M[t]);m.has(h)||m.set(h,s)}return m}}class x{constructor(){this.distance=-1,this.index=-1}}class z{static quantize(t){const s=new Map;for(let h=0;t.length>h;h++){const i=t[h];255>(i>>24&255)||s.set(i,(s.get(i)??0)+1)}return s}}const V=33,k=35937,q="red",B="green",T="blue";class E{constructor(t=[],s=[],h=[],i=[],n=[],r=[]){this.weights=t,this.momentsR=s,this.momentsG=h,this.momentsB=i,this.moments=n,this.cubes=r}quantize(t,s){this.constructHistogram(t),this.computeMoments();const h=this.createBoxes(s);return this.createResult(h.resultCount)}constructHistogram(t){this.weights=Array.from({length:k}).fill(0),this.momentsR=Array.from({length:k}).fill(0),this.momentsG=Array.from({length:k}).fill(0),this.momentsB=Array.from({length:k}).fill(0),this.moments=Array.from({length:k}).fill(0);const s=z.quantize(t);for(const[t,h]of s.entries()){const s=r(t),i=e(t),n=a(t),o=3,c=this.getIndex(1+(s>>o),1+(i>>o),1+(n>>o));this.weights[c]=(this.weights[c]??0)+h,this.momentsR[c]+=h*s,this.momentsG[c]+=h*i,this.momentsB[c]+=h*n,this.moments[c]+=h*(s*s+i*i+n*n)}}computeMoments(){for(let t=1;V>t;t++){const s=Array.from({length:V}).fill(0),h=Array.from({length:V}).fill(0),i=Array.from({length:V}).fill(0),n=Array.from({length:V}).fill(0),r=Array.from({length:V}).fill(0);for(let e=1;V>e;e++){let a=0,o=0,c=0,M=0,u=0;for(let l=1;V>l;l++){const f=this.getIndex(t,e,l);a+=this.weights[f],o+=this.momentsR[f],c+=this.momentsG[f],M+=this.momentsB[f],u+=this.moments[f],s[l]+=a,h[l]+=o,i[l]+=c,n[l]+=M,r[l]+=u;const d=this.getIndex(t-1,e,l);this.weights[f]=this.weights[d]+s[l],this.momentsR[f]=this.momentsR[d]+h[l],this.momentsG[f]=this.momentsG[d]+i[l],this.momentsB[f]=this.momentsB[d]+n[l],this.moments[f]=this.moments[d]+r[l]}}}}createBoxes(t){this.cubes=Array.from({length:t}).fill(0).map((()=>new J));const s=Array.from({length:t}).fill(0);this.cubes[0].r0=0,this.cubes[0].g0=0,this.cubes[0].b0=0,this.cubes[0].r1=32,this.cubes[0].g1=32,this.cubes[0].b1=32;let h=t,i=0;for(let n=1;t>n;n++){this.cut(this.cubes[i],this.cubes[n])?(s[i]=this.cubes[i].vol>1?this.variance(this.cubes[i]):0,s[n]=this.cubes[n].vol>1?this.variance(this.cubes[n]):0):(s[i]=0,n--),i=0;let t=s[0];for(let h=1;n>=h;h++)s[h]>t&&(t=s[h],i=h);if(0>=t){h=n+1;break}}return new P(t,h)}createResult(t){const s=[];for(let h=0;t>h;++h){const t=this.cubes[h],i=this.volume(t,this.weights);if(i>0){const h=Math.round(this.volume(t,this.momentsR)/i),n=Math.round(this.volume(t,this.momentsG)/i),r=Math.round(this.volume(t,this.momentsB)/i);s.push(255<<24|(255&h)<<16|(255&n)<<8|255&r)}}return s}variance(t){const s=this.volume(t,this.momentsR),h=this.volume(t,this.momentsG),i=this.volume(t,this.momentsB);return this.moments[this.getIndex(t.r1,t.g1,t.b1)]-this.moments[this.getIndex(t.r1,t.g1,t.b0)]-this.moments[this.getIndex(t.r1,t.g0,t.b1)]+this.moments[this.getIndex(t.r1,t.g0,t.b0)]-this.moments[this.getIndex(t.r0,t.g1,t.b1)]+this.moments[this.getIndex(t.r0,t.g1,t.b0)]+this.moments[this.getIndex(t.r0,t.g0,t.b1)]-this.moments[this.getIndex(t.r0,t.g0,t.b0)]-(s*s+h*h+i*i)/this.volume(t,this.weights)}cut(t,s){const h=this.volume(t,this.momentsR),i=this.volume(t,this.momentsG),n=this.volume(t,this.momentsB),r=this.volume(t,this.weights),e=this.maximize(t,q,t.r0+1,t.r1,h,i,n,r),a=this.maximize(t,B,t.g0+1,t.g1,h,i,n,r),o=this.maximize(t,T,t.b0+1,t.b1,h,i,n,r);let c;const M=e.maximum,u=a.maximum,l=o.maximum;if(u>M||l>M)c=M>u||l>u?T:B;else{if(0>e.cutLocation)return 0;c=q}switch(s.r1=t.r1,s.g1=t.g1,s.b1=t.b1,c){case q:t.r1=e.cutLocation,s.r0=t.r1,s.g0=t.g0,s.b0=t.b0;break;case B:t.g1=a.cutLocation,s.r0=t.r0,s.g0=t.g1,s.b0=t.b0;break;case T:t.b1=o.cutLocation,s.r0=t.r0,s.g0=t.g0,s.b0=t.b1;break;default:throw Error("unexpected direction "+c)}return t.vol=(t.r1-t.r0)*(t.g1-t.g0)*(t.b1-t.b0),s.vol=(s.r1-s.r0)*(s.g1-s.g0)*(s.b1-s.b0),1}maximize(t,s,h,i,n,r,e,a){const o=this.bottom(t,s,this.momentsR),c=this.bottom(t,s,this.momentsG),M=this.bottom(t,s,this.momentsB),u=this.bottom(t,s,this.weights);let l=0,f=-1,d=0,w=0,m=0,g=0;for(let y=h;i>y;y++){if(d=o+this.top(t,s,y,this.momentsR),w=c+this.top(t,s,y,this.momentsG),m=M+this.top(t,s,y,this.momentsB),g=u+this.top(t,s,y,this.weights),0===g)continue;let h=1*(d*d+w*w+m*m),i=1*g,A=h/i;d=n-d,w=r-w,m=e-m,g=a-g,0!==g&&(h=1*(d*d+w*w+m*m),i=1*g,A+=h/i,A>l&&(l=A,f=y))}return new R(f,l)}volume(t,s){return s[this.getIndex(t.r1,t.g1,t.b1)]-s[this.getIndex(t.r1,t.g1,t.b0)]-s[this.getIndex(t.r1,t.g0,t.b1)]+s[this.getIndex(t.r1,t.g0,t.b0)]-s[this.getIndex(t.r0,t.g1,t.b1)]+s[this.getIndex(t.r0,t.g1,t.b0)]+s[this.getIndex(t.r0,t.g0,t.b1)]-s[this.getIndex(t.r0,t.g0,t.b0)]}bottom(t,s,h){switch(s){case q:return-h[this.getIndex(t.r0,t.g1,t.b1)]+h[this.getIndex(t.r0,t.g1,t.b0)]+h[this.getIndex(t.r0,t.g0,t.b1)]-h[this.getIndex(t.r0,t.g0,t.b0)];case B:return-h[this.getIndex(t.r1,t.g0,t.b1)]+h[this.getIndex(t.r1,t.g0,t.b0)]+h[this.getIndex(t.r0,t.g0,t.b1)]-h[this.getIndex(t.r0,t.g0,t.b0)];case T:return-h[this.getIndex(t.r1,t.g1,t.b0)]+h[this.getIndex(t.r1,t.g0,t.b0)]+h[this.getIndex(t.r0,t.g1,t.b0)]-h[this.getIndex(t.r0,t.g0,t.b0)];default:throw Error("unexpected direction $direction")}}top(t,s,h,i){switch(s){case q:return i[this.getIndex(h,t.g1,t.b1)]-i[this.getIndex(h,t.g1,t.b0)]-i[this.getIndex(h,t.g0,t.b1)]+i[this.getIndex(h,t.g0,t.b0)];case B:return i[this.getIndex(t.r1,h,t.b1)]-i[this.getIndex(t.r1,h,t.b0)]-i[this.getIndex(t.r0,h,t.b1)]+i[this.getIndex(t.r0,h,t.b0)];case T:return i[this.getIndex(t.r1,t.g1,h)]-i[this.getIndex(t.r1,t.g0,h)]-i[this.getIndex(t.r0,t.g1,h)]+i[this.getIndex(t.r0,t.g0,h)];default:throw Error("unexpected direction $direction")}}getIndex(t,s,h){return(t<<10)+(t<<6)+t+(s<<5)+s+h}}class J{constructor(t=0,s=0,h=0,i=0,n=0,r=0,e=0){this.r0=t,this.r1=s,this.g0=h,this.g1=i,this.b0=n,this.b1=r,this.vol=e}}class P{constructor(t,s){this.requestedCount=t,this.resultCount=s}}class R{constructor(t,s){this.cutLocation=t,this.maximum=s}}class H{static quantize(t,s){const h=(new E).quantize(t,s);return C.quantize(t,h,s)}}export{v as H,H as Q,i as a,w as h};